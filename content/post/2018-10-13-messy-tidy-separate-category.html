---
title: 'From Messy to Tidy: Separate the Category'
author: Recle Etino Vibal
date: '2018-10-13'
categories:
  - lessons
  - Philippines
  - tidy data
  - tidyverse
tags:
  - consumer price index
  - dplyr
  - rebus
  - tidyr
slug: messy-tidy-separate-category
output:
  blogdown::html_page:
    toc: yes
    number_sections: yes
bibliography:
  - references/messy-to-tidy.bib
biblio-style: apalike
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/dt-ext-fixedcolumns/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-ext-fixedcolumns/js/dataTables.fixedColumns.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>

<div id="TOC">
<ul>
<li><a href="#dates-in-one-column"><span class="toc-section-number">1</span> Dates in One Column</a></li>
<li><a href="#deciphering-the-code-column"><span class="toc-section-number">2</span> Deciphering the Code Column</a></li>
<li><a href="#split-stretch-and-trickle-down"><span class="toc-section-number">3</span> Split, Stretch, and Trickle Down</a><ul>
<li><a href="#cut-the-dots"><span class="toc-section-number">3.1</span> Cut the Dots</a></li>
<li><a href="#count-the-dots"><span class="toc-section-number">3.2</span> Count the Dots</a></li>
<li><a href="#spread-the-categories"><span class="toc-section-number">3.3</span> Spread the Categories</a></li>
<li><a href="#pull-the-one-above"><span class="toc-section-number">3.4</span> Pull the One Above</a></li>
</ul></li>
<li><a href="#join-and-split"><span class="toc-section-number">4</span> Join and Split</a></li>
<li><a href="#up-next"><span class="toc-section-number">5</span> Up Next</a></li>
<li><a href="#code"><span class="toc-section-number">6</span> Code</a></li>
<li><a href="#references"><span class="toc-section-number">7</span> References</a></li>
</ul>
</div>

<div id="dates-in-one-column" class="section level1">
<h1><span class="header-section-number">1</span> Dates in One Column</h1>
<p>The <a href="https://amateurdatasci.rbind.io/post/messy-tidy-tidyr-gather/">first post</a> in the From Messy to Tidy series introduced us to the idea of tidy data <span class="citation">(Wickham 2014)</span>:</p>
<blockquote>
<p>Data is tidy when 1. Every column is a variable, 2. Every row is an observation, and 3. Every observational unit forms a table.</p>
</blockquote>
<p>Dates as column names is one sign of a <strong>messy</strong> data. My previous post focused on collecting the date columns into a single column and converting the dates to <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> (YYYY-MM-DD) format.</p>
<p>Here is a sample view of the data<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> so far. While reading the data into this post, I also cleaned the column names to replace the unnecesary spaces with underscores. I did this, and can do more column names cleaning with <code>janitor::clean_names()</code> <span class="citation">(Firke 2018)</span>.</p>
<p>I realized that I was repeatedly changing the options of <code>DT::datatable()</code> <span class="citation">(Xie 2018)</span> when I am using it, so I just made a new function, <code>show_datatable()</code>, with all the settings I want.</p>
<div class="figure"><span id="fig:read-show-sample"></span>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],["Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines"],["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1"],["All Items","Food And Non-Alcoholic Beverages","Food","Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.","Non-Alcoholic Beverages","Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices","Alcoholic Beverages And Tobacco","Alcoholic Beverages","Spirits","Wine","Beer","Tobacco","Tobacco","Non-Food","Clothing And Footwear","Clothing","Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing","Footwear","Shoes And Other Footwear","Repair And Hire Of Footwear","Housing, Water, Electricity, Gas And Other Fuels","Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Materials For The Maintenance And Repair Of The Dwelling"],["49.4","54.4","54.0","55.3","56.9","49.0","51.9","58.4","49.2","52.7","45.3","53.3","52.2","44.1","61.0","59.8","56.3","62.6","54.3","50.6","53.7","51.5","48.1","58.2","58.2","46.1","58.0","58.7","77.0","61.3","57.5","46.6","56.1","56.1","-","43.6","41.5","41.5","57.2","60.5"],["1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>geographic_code<\/th>\n      <th>geographic_code_1<\/th>\n      <th>geographic_location<\/th>\n      <th>code<\/th>\n      <th>description<\/th>\n      <th>cpi<\/th>\n      <th>date_cpi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 1.1: Sample Philippine Consumer Price Index Data with a Single ISO 8601 Date Column.
</p>
</div>
<p>For all the code I used in this post, please refer to <a href="#code">6</a>.</p>
</div>
<div id="deciphering-the-code-column" class="section level1">
<h1><span class="header-section-number">2</span> Deciphering the Code Column</h1>
<p>One quick look at Figure <a href="#fig:read-show-sample">1.1</a> reminds us that the data is not yet tidy. For one, what does the <code>Code</code> column mean?</p>
<p>Some of the readers might have noticed it already, but it took me a while to realize that the <code>code</code> column is related to the <code>description</code> column. We can see this better if we isolate the <code>code</code> and <code>description</code> columns. I did this with <code>dplyr::distinct()</code> <span class="citation">(Wickham et al. 2018)</span>.</p>
<div class="figure"><span id="fig:code-description"></span>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2","07.2.3","07.3","07.3.1","07.3.2","07.3.3","07.3.4","08","08.1","08.1.0","08.2","08.2.0","08.3","08.3.0","09","09.1","09.1.1","09.1.2","09.1.3","09.1.4","09.1.5","09.2","09.2.2","09.3","09.3.1","09.3.2","09.3.3","09.3.4","09.3.5","09.4","09.4.1","09.4.2","09.4.3","09.5","09.5.1","09.5.2","09.5.3","09.5.4","10","10.1","10.1.1","10.1.2","10.2","10.2.1","10.2.3","10.4","10.4.1","10.4.2","10.5","10.5.2","11","11.1","11.1.1","11.2","11.2.1","11.2.3","11.3","11.3.1","11.3.2","01"],["All Items","Food And Non-Alcoholic Beverages","Food","Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.","Non-Alcoholic Beverages","Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices","Alcoholic Beverages And Tobacco","Alcoholic Beverages","Spirits","Wine","Beer","Tobacco","Tobacco","Non-Food","Clothing And Footwear","Clothing","Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing","Footwear","Shoes And Other Footwear","Repair And Hire Of Footwear","Housing, Water, Electricity, Gas And Other Fuels","Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply","Electricity, Gas And Other Fuels","Electricity","Gas","Solid Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings","Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Major Tools And Equipment","Small Tools And Miscellaneous Accessories","Goods And Services For Routine Household Maintenance","Non-Durable Household Goods","Domestic Services And Household Services","Health","Medical Products, Appliances And Equipment","Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment","Out-Patient Services","Medical Services","Dental Services","Paramedical Services","Hospital Services","Hospital Services","Transport","Operation Of Personal Transport Equipment","Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment","Maintenance And Repair Of Personal Transport Equipment","Transport Services","Passenger Transport By Railway","Passenger Transport By Road","Passenger Transport By Air","Passenger Transport By Sea And Inland Waterway","Communication","Postal Services","Postal Services","Telephone And Telefax Equipment","Telephone And Telefax Equipment","Telephone And Telefax Services","Telephone And Telefax Services","Recreation And Culture","Audio-Visual, Photographic And Information Processing Equipment","Equipment For The Reception, Recording And Reproduction Of Sound And Pictures","Photographic And Cinematographic Equipment And Optical Instruments","Information Processing Equipment","Recording Media","Repair Of Audio-Visual, Photographic And Information Processing Equipment","Other Major Durables For Recreation And Culture","Musical Instruments And Major Durables For Indoor Recreation","Other Recreational Items And Equipment, Gardens And Pets","Games, Toys And Hobbies","Equipment For Sport, Camping And Open-Air Recreation","Gardens, Plants And Flowers","Pets And Related Products","Veterinary And Other Services For Pets","Recreational And Cultural Services","Recreational And Sporting Services","Cultural Services","Games Of Chance","Newspapers, Books And Stationery","Books","Newspapers And Periodicals","Miscellaneous Printed Matter","Stationery And Drawing Materials","Education","Pre-Primary And Primary Education","Pre-Primary Education (Level 0)","Primary Education (Level 1)","Secondary Education","General Secondary Education","Vocational Or Technical Secondary Education","Tertiary Education","First Stage Of Tertiary Education","Second Stage Of Tertiary Education","Education Not Definable By Level","Private Education Not Definable By Level","Restaurants And Miscellaneous Goods And Services","Catering Services","Restaurants, Cafes And The Like","Personal Care","Hairdressing Salons And Personal Grooming Establishments","Other Appliances, Articles And Products For Personal Care","Personal Effects N.E.C.","Jewellery, Clocks And Watches","Other Personal Effects","Food And Non-Alcholic Beverages"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>code<\/th>\n      <th>description<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 2.1: The <code>code</code> and <code>description</code> Column Relationship.
</p>
</div>
<p>Upon reviewing Figure <a href="#fig:code-description">2.1</a>, I noticed that the <code>code</code> and <code>description</code> columns identify the same thing, on what item the consumer price index measures. For example, a 01 <code>code</code> refers to the Food and Non-Alcoholic Beverages category. If we notice that 01.1 refers to the Food category and 01.2 to the Non-Alcoholic Bevarages category, then we get the pattern. A # <code>code</code> refers to the top category, #.# to the item’s subcategory, and #.#.# to the item’s sub-subcategory.</p>
<p>The <code>description</code> can be thought of as variable because one observation of an item can only have one description. However, the <code>code</code> is a representation of at most three variables. I think this violates tidy data principles. Each level should have its own column, in my opinion. The <code>code</code> column is good for identification purposes, but this is not as useful to the data analyst. Imagine if we want to look at only the subcategories of Recreation and Culture. It will take us some time to understand the <code>code</code> column first before we can do what we want.</p>
<p>From Figure <a href="#fig:code-description">2.1</a>, the duplicate of <code>code</code> 01 sticks out like a sore thumb. Instead of Non-Alcoholic one description has Non-Alcholic. I removed this duplicate row in the item description table I was making before proceeding. I used <code>stringr::str_detect()</code> <span class="citation">(Wickham 2018)</span> to do this. We don’t need to worry about the Non-Alcholic in the original consumer price index data set because we will remove the original description colum later anyway.</p>
</div>
<div id="split-stretch-and-trickle-down" class="section level1">
<h1><span class="header-section-number">3</span> Split, Stretch, and Trickle Down</h1>
<p>Splitting the <code>code</code> column into three looks easy. However, I realized I wanted the subcategories to have their main categories, and the sub-subcategories to have their sub- and main categories, making things more complicated. To accomplish this, I followed the following steps:</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Split the code column into category levels.</li>
<li>Identify the item category level of the the description.</li>
<li>Distribute the description to the appropriate category level.</li>
<li>Supply the missing levels for each item.</li>
</ol>
</blockquote>
<div id="cut-the-dots" class="section level2">
<h2><span class="header-section-number">3.1</span> Cut the Dots</h2>
<p>I am thankful to the <a href="http://openstat.psa.gov.ph/">Philippine Statistics Authority</a> that they encoded the <code>code</code> column with dots separating each category level because this makes it easy to extract the code levels with <code>tidry::separate()</code> <span class="citation">(Wickham and Henry 2018)</span>. See Figure <a href="#fig:separate-code">3.1</a>.</p>
<div class="figure"><span id="fig:separate-code"></span>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2","07.2.3","07.3","07.3.1","07.3.2","07.3.3","07.3.4","08","08.1","08.1.0","08.2","08.2.0","08.3","08.3.0","09","09.1","09.1.1","09.1.2","09.1.3","09.1.4","09.1.5","09.2","09.2.2","09.3","09.3.1","09.3.2","09.3.3","09.3.4","09.3.5","09.4","09.4.1","09.4.2","09.4.3","09.5","09.5.1","09.5.2","09.5.3","09.5.4","10","10.1","10.1.1","10.1.2","10.2","10.2.1","10.2.3","10.4","10.4.1","10.4.2","10.5","10.5.2","11","11.1","11.1.1","11.2","11.2.1","11.2.3","11.3","11.3.1","11.3.2"],["0","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","02","02","02","02","02","02","02","02","03","03","03","03","03","03","03","03","03","04","04","04","04","04","04","04","04","04","04","04","04","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","06","06","06","06","06","06","06","06","06","06","06","07","07","07","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","10","10","10","10","10","10","10","10","10","10","10","10","11","11","11","11","11","11","11","11","11"],[null,null,"1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2",null,"1","1","1","1","2","2","40",null,"1","1","1","1","1","2","2","2",null,"1","1","3","3","3","4","4","5","5","5","5",null,"1","1","1","2","2","3","3","3","3","4","4","5","5","5","6","6","6",null,"1","1","1","1","2","2","2","2","3","3",null,"2","2","2","2","3","3","3","3","3",null,"1","1","2","2","3","3",null,"1","1","1","1","1","1","2","2","3","3","3","3","3","3","4","4","4","4","5","5","5","5","5",null,"1","1","1","2","2","2","4","4","4","5","5",null,"1","1","2","2","2","3","3","3"],[null,null,null,"1","11","12","120","2","3","4","5","6","7","8","9",null,"1","2",null,null,"1","2","3",null,"0",null,null,null,"1","2","3","4",null,"1","2",null,null,"1",null,"1","2",null,"1",null,"1","2","4",null,null,"1","2",null,"0",null,"1","2","3",null,"0",null,"1","2",null,"1","2",null,null,"1","2","3",null,"1","2","3",null,"0",null,null,"1","2","3",null,"1","2","3","4",null,null,"0",null,"0",null,"0",null,null,"1","2","3","4","5",null,"2",null,"1","2","3","4","5",null,"1","2","3",null,"1","2","3","4",null,null,"1","2",null,"1","3",null,"1","2",null,"2",null,null,"1",null,"1","3",null,"1","2"],["All Items","Food And Non-Alcoholic Beverages","Food","Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.","Non-Alcoholic Beverages","Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices","Alcoholic Beverages And Tobacco","Alcoholic Beverages","Spirits","Wine","Beer","Tobacco","Tobacco","Non-Food","Clothing And Footwear","Clothing","Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing","Footwear","Shoes And Other Footwear","Repair And Hire Of Footwear","Housing, Water, Electricity, Gas And Other Fuels","Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply","Electricity, Gas And Other Fuels","Electricity","Gas","Solid Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings","Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Major Tools And Equipment","Small Tools And Miscellaneous Accessories","Goods And Services For Routine Household Maintenance","Non-Durable Household Goods","Domestic Services And Household Services","Health","Medical Products, Appliances And Equipment","Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment","Out-Patient Services","Medical Services","Dental Services","Paramedical Services","Hospital Services","Hospital Services","Transport","Operation Of Personal Transport Equipment","Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment","Maintenance And Repair Of Personal Transport Equipment","Transport Services","Passenger Transport By Railway","Passenger Transport By Road","Passenger Transport By Air","Passenger Transport By Sea And Inland Waterway","Communication","Postal Services","Postal Services","Telephone And Telefax Equipment","Telephone And Telefax Equipment","Telephone And Telefax Services","Telephone And Telefax Services","Recreation And Culture","Audio-Visual, Photographic And Information Processing Equipment","Equipment For The Reception, Recording And Reproduction Of Sound And Pictures","Photographic And Cinematographic Equipment And Optical Instruments","Information Processing Equipment","Recording Media","Repair Of Audio-Visual, Photographic And Information Processing Equipment","Other Major Durables For Recreation And Culture","Musical Instruments And Major Durables For Indoor Recreation","Other Recreational Items And Equipment, Gardens And Pets","Games, Toys And Hobbies","Equipment For Sport, Camping And Open-Air Recreation","Gardens, Plants And Flowers","Pets And Related Products","Veterinary And Other Services For Pets","Recreational And Cultural Services","Recreational And Sporting Services","Cultural Services","Games Of Chance","Newspapers, Books And Stationery","Books","Newspapers And Periodicals","Miscellaneous Printed Matter","Stationery And Drawing Materials","Education","Pre-Primary And Primary Education","Pre-Primary Education (Level 0)","Primary Education (Level 1)","Secondary Education","General Secondary Education","Vocational Or Technical Secondary Education","Tertiary Education","First Stage Of Tertiary Education","Second Stage Of Tertiary Education","Education Not Definable By Level","Private Education Not Definable By Level","Restaurants And Miscellaneous Goods And Services","Catering Services","Restaurants, Cafes And The Like","Personal Care","Hairdressing Salons And Personal Grooming Establishments","Other Appliances, Articles And Products For Personal Care","Personal Effects N.E.C.","Jewellery, Clocks And Watches","Other Personal Effects"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>code<\/th>\n      <th>code_1<\/th>\n      <th>code_2<\/th>\n      <th>code_3<\/th>\n      <th>description<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.1: <code>The code</code> Separated. Cut Along the Dots.
</p>
</div>
<p>I converted the <code>code</code> column into three<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> new columns: <code>code_1</code>, <code>code_2</code>, and <code>code_3</code>. I did not have to specify the <code>sep</code> argument because <code>tidyr::separate()</code> by default splits on non-alphanumeric characters. I did set <code>remove = FALSE</code> so that the <code>code</code> column will still be there after the split.</p>
</div>
<div id="count-the-dots" class="section level2">
<h2><span class="header-section-number">3.2</span> Count the Dots</h2>
<p>Identifying the category level of a <code>description</code> required a little creativity. We know the category level of a <code>description</code> by counting the <code>code</code> levels. The dots again becomes a blessing here because if a <code>code</code> has no dot, then it is a main category; if it has one dot, then it is a secondary category; if it has two dots, then it is a tertiary category.</p>
<p>Counting dots can be done with <code>stringr::str_count()</code> <span class="citation">(Wickham 2018)</span> and with the help of <code>rebus::DOT</code> <span class="citation">(Cotton 2017)</span>.</p>
<div class="figure"><span id="fig:identify-description-level"></span>
<div id="htmlwidget-4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2","07.2.3","07.3","07.3.1","07.3.2","07.3.3","07.3.4","08","08.1","08.1.0","08.2","08.2.0","08.3","08.3.0","09","09.1","09.1.1","09.1.2","09.1.3","09.1.4","09.1.5","09.2","09.2.2","09.3","09.3.1","09.3.2","09.3.3","09.3.4","09.3.5","09.4","09.4.1","09.4.2","09.4.3","09.5","09.5.1","09.5.2","09.5.3","09.5.4","10","10.1","10.1.1","10.1.2","10.2","10.2.1","10.2.3","10.4","10.4.1","10.4.2","10.5","10.5.2","11","11.1","11.1.1","11.2","11.2.1","11.2.3","11.3","11.3.1","11.3.2"],["0","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","02","02","02","02","02","02","02","02","03","03","03","03","03","03","03","03","03","04","04","04","04","04","04","04","04","04","04","04","04","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","06","06","06","06","06","06","06","06","06","06","06","07","07","07","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","10","10","10","10","10","10","10","10","10","10","10","10","11","11","11","11","11","11","11","11","11"],[null,null,"1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2",null,"1","1","1","1","2","2","40",null,"1","1","1","1","1","2","2","2",null,"1","1","3","3","3","4","4","5","5","5","5",null,"1","1","1","2","2","3","3","3","3","4","4","5","5","5","6","6","6",null,"1","1","1","1","2","2","2","2","3","3",null,"2","2","2","2","3","3","3","3","3",null,"1","1","2","2","3","3",null,"1","1","1","1","1","1","2","2","3","3","3","3","3","3","4","4","4","4","5","5","5","5","5",null,"1","1","1","2","2","2","4","4","4","5","5",null,"1","1","2","2","2","3","3","3"],[null,null,null,"1","11","12","120","2","3","4","5","6","7","8","9",null,"1","2",null,null,"1","2","3",null,"0",null,null,null,"1","2","3","4",null,"1","2",null,null,"1",null,"1","2",null,"1",null,"1","2","4",null,null,"1","2",null,"0",null,"1","2","3",null,"0",null,"1","2",null,"1","2",null,null,"1","2","3",null,"1","2","3",null,"0",null,null,"1","2","3",null,"1","2","3","4",null,null,"0",null,"0",null,"0",null,null,"1","2","3","4","5",null,"2",null,"1","2","3","4","5",null,"1","2","3",null,"1","2","3","4",null,null,"1","2",null,"1","3",null,"1","2",null,"2",null,null,"1",null,"1","3",null,"1","2"],["All Items","Food And Non-Alcoholic Beverages","Food","Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.","Non-Alcoholic Beverages","Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices","Alcoholic Beverages And Tobacco","Alcoholic Beverages","Spirits","Wine","Beer","Tobacco","Tobacco","Non-Food","Clothing And Footwear","Clothing","Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing","Footwear","Shoes And Other Footwear","Repair And Hire Of Footwear","Housing, Water, Electricity, Gas And Other Fuels","Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply","Electricity, Gas And Other Fuels","Electricity","Gas","Solid Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings","Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Major Tools And Equipment","Small Tools And Miscellaneous Accessories","Goods And Services For Routine Household Maintenance","Non-Durable Household Goods","Domestic Services And Household Services","Health","Medical Products, Appliances And Equipment","Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment","Out-Patient Services","Medical Services","Dental Services","Paramedical Services","Hospital Services","Hospital Services","Transport","Operation Of Personal Transport Equipment","Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment","Maintenance And Repair Of Personal Transport Equipment","Transport Services","Passenger Transport By Railway","Passenger Transport By Road","Passenger Transport By Air","Passenger Transport By Sea And Inland Waterway","Communication","Postal Services","Postal Services","Telephone And Telefax Equipment","Telephone And Telefax Equipment","Telephone And Telefax Services","Telephone And Telefax Services","Recreation And Culture","Audio-Visual, Photographic And Information Processing Equipment","Equipment For The Reception, Recording And Reproduction Of Sound And Pictures","Photographic And Cinematographic Equipment And Optical Instruments","Information Processing Equipment","Recording Media","Repair Of Audio-Visual, Photographic And Information Processing Equipment","Other Major Durables For Recreation And Culture","Musical Instruments And Major Durables For Indoor Recreation","Other Recreational Items And Equipment, Gardens And Pets","Games, Toys And Hobbies","Equipment For Sport, Camping And Open-Air Recreation","Gardens, Plants And Flowers","Pets And Related Products","Veterinary And Other Services For Pets","Recreational And Cultural Services","Recreational And Sporting Services","Cultural Services","Games Of Chance","Newspapers, Books And Stationery","Books","Newspapers And Periodicals","Miscellaneous Printed Matter","Stationery And Drawing Materials","Education","Pre-Primary And Primary Education","Pre-Primary Education (Level 0)","Primary Education (Level 1)","Secondary Education","General Secondary Education","Vocational Or Technical Secondary Education","Tertiary Education","First Stage Of Tertiary Education","Second Stage Of Tertiary Education","Education Not Definable By Level","Private Education Not Definable By Level","Restaurants And Miscellaneous Goods And Services","Catering Services","Restaurants, Cafes And The Like","Personal Care","Hairdressing Salons And Personal Grooming Establishments","Other Appliances, Articles And Products For Personal Care","Personal Effects N.E.C.","Jewellery, Clocks And Watches","Other Personal Effects"],["item_category_1","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_2","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_2","item_category_3","item_category_2","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_3","item_category_3","item_category_1","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_1","item_category_2","item_category_3","item_category_2","item_category_3","item_category_3","item_category_2","item_category_3","item_category_3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>code<\/th>\n      <th>code_1<\/th>\n      <th>code_2<\/th>\n      <th>code_3<\/th>\n      <th>description<\/th>\n      <th>category_level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.2: The <code>description</code> Identified. A Category Level for Each Item Description.
</p>
</div>
<p>From Figure <a href="#fig:identify-description-level">3.2</a>, observe that I could also identify which <code>description</code> where main, sub, or sub-sub by determining if a <code>description</code> was missing either <code>code_1</code>, <code>code_2</code>, or <code>code_3</code>. However, I think this method is more tedious. Counting the dots just felt simpler.</p>
</div>
<div id="spread-the-categories" class="section level2">
<h2><span class="header-section-number">3.3</span> Spread the Categories</h2>
<p>With the <code>description</code> column identified into its respective category level, we can convert the column of category into three different columns with the <code>description</code> as values. This process will be the opposite of <code>tidyr::gather()</code>. Instead of taking multiple columns and collecting them in a single column, we need to transform a single column into multiple columns. The opposite of gather is spread, and the function for this task is <code>tidyr::spread()</code> <span class="citation">(Wickham and Henry 2018)</span>.</p>
<div class="figure"><span id="fig:spread-description"></span>
<div id="htmlwidget-5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2","07.2.3","07.3","07.3.1","07.3.2","07.3.3","07.3.4","08","08.1","08.1.0","08.2","08.2.0","08.3","08.3.0","09","09.1","09.1.1","09.1.2","09.1.3","09.1.4","09.1.5","09.2","09.2.2","09.3","09.3.1","09.3.2","09.3.3","09.3.4","09.3.5","09.4","09.4.1","09.4.2","09.4.3","09.5","09.5.1","09.5.2","09.5.3","09.5.4","10","10.1","10.1.1","10.1.2","10.2","10.2.1","10.2.3","10.4","10.4.1","10.4.2","10.5","10.5.2","11","11.1","11.1.1","11.2","11.2.1","11.2.3","11.3","11.3.1","11.3.2"],["0","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","01","02","02","02","02","02","02","02","02","03","03","03","03","03","03","03","03","03","04","04","04","04","04","04","04","04","04","04","04","04","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","05","06","06","06","06","06","06","06","06","06","06","06","07","07","07","07","07","07","07","07","07","07","08","08","08","08","08","08","08","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","09","10","10","10","10","10","10","10","10","10","10","10","10","11","11","11","11","11","11","11","11","11"],[null,null,"1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2",null,"1","1","1","1","2","2","40",null,"1","1","1","1","1","2","2","2",null,"1","1","3","3","3","4","4","5","5","5","5",null,"1","1","1","2","2","3","3","3","3","4","4","5","5","5","6","6","6",null,"1","1","1","1","2","2","2","2","3","3",null,"2","2","2","2","3","3","3","3","3",null,"1","1","2","2","3","3",null,"1","1","1","1","1","1","2","2","3","3","3","3","3","3","4","4","4","4","5","5","5","5","5",null,"1","1","1","2","2","2","4","4","4","5","5",null,"1","1","2","2","2","3","3","3"],[null,null,null,"1","11","12","120","2","3","4","5","6","7","8","9",null,"1","2",null,null,"1","2","3",null,"0",null,null,null,"1","2","3","4",null,"1","2",null,null,"1",null,"1","2",null,"1",null,"1","2","4",null,null,"1","2",null,"0",null,"1","2","3",null,"0",null,"1","2",null,"1","2",null,null,"1","2","3",null,"1","2","3",null,"0",null,null,"1","2","3",null,"1","2","3","4",null,null,"0",null,"0",null,"0",null,null,"1","2","3","4","5",null,"2",null,"1","2","3","4","5",null,"1","2","3",null,"1","2","3","4",null,null,"1","2",null,"1","3",null,"1","2",null,"2",null,null,"1",null,"1","3",null,"1","2"],["All Items","Food And Non-Alcoholic Beverages",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Alcoholic Beverages And Tobacco",null,null,null,null,null,null,null,"Clothing And Footwear",null,null,null,null,null,null,null,null,"Housing, Water, Electricity, Gas And Other Fuels",null,null,null,null,null,null,null,null,null,null,null,"Furnishings, Household Equipment And Routing Maintenance Of The House",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Health",null,null,null,null,null,null,null,null,null,null,"Transport",null,null,null,null,null,null,null,null,null,"Communication",null,null,null,null,null,null,"Recreation And Culture",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Education",null,null,null,null,null,null,null,null,null,null,null,"Restaurants And Miscellaneous Goods And Services",null,null,null,null,null,null,null,null],[null,null,"Food",null,null,null,null,null,null,null,null,null,null,null,null,"Non-Alcoholic Beverages",null,null,null,"Alcoholic Beverages",null,null,null,"Tobacco",null,"Non-Food",null,"Clothing",null,null,null,null,"Footwear",null,null,null,"Rentals For Housing",null,"Maintenance And Repair Of The Dwelling",null,null,"Water Supply And Miscellaneous Services Relating To The Dweling",null,"Electricity, Gas And Other Fuels",null,null,null,null,"Furniture And Furnishings, Carpets And Other Floor Coverings",null,null,"Household Textiles",null,"Household Appliances",null,null,null,"Glassware, Tableware And Household Utensils",null,"Tools And Equipment For House And Garden",null,null,"Goods And Services For Routine Household Maintenance",null,null,null,"Medical Products, Appliances And Equipment",null,null,null,"Out-Patient Services",null,null,null,"Hospital Services",null,null,"Operation Of Personal Transport Equipment",null,null,null,"Transport Services",null,null,null,null,null,"Postal Services",null,"Telephone And Telefax Equipment",null,"Telephone And Telefax Services",null,null,"Audio-Visual, Photographic And Information Processing Equipment",null,null,null,null,null,"Other Major Durables For Recreation And Culture",null,"Other Recreational Items And Equipment, Gardens And Pets",null,null,null,null,null,"Recreational And Cultural Services",null,null,null,"Newspapers, Books And Stationery",null,null,null,null,null,"Pre-Primary And Primary Education",null,null,"Secondary Education",null,null,"Tertiary Education",null,null,"Education Not Definable By Level",null,null,"Catering Services",null,"Personal Care",null,null,"Personal Effects N.E.C.",null,null],[null,null,null,"Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.",null,"Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices",null,null,"Spirits","Wine","Beer",null,"Tobacco",null,null,null,"Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing",null,"Shoes And Other Footwear","Repair And Hire Of Footwear",null,null,"Rentals For Housing",null,"Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling",null,"Water Supply",null,"Electricity","Gas","Solid Fuels",null,null,"Furniture And Furnishings","Carpets And Other Floor Coverings",null,"Household Textiles",null,"Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances",null,"Glassware, Tableware And Household Utensils",null,"Major Tools And Equipment","Small Tools And Miscellaneous Accessories",null,"Non-Durable Household Goods","Domestic Services And Household Services",null,null,"Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment",null,"Medical Services","Dental Services","Paramedical Services",null,"Hospital Services",null,null,"Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment","Maintenance And Repair Of Personal Transport Equipment",null,"Passenger Transport By Railway","Passenger Transport By Road","Passenger Transport By Air","Passenger Transport By Sea And Inland Waterway",null,null,"Postal Services",null,"Telephone And Telefax Equipment",null,"Telephone And Telefax Services",null,null,"Equipment For The Reception, Recording And Reproduction Of Sound And Pictures","Photographic And Cinematographic Equipment And Optical Instruments","Information Processing Equipment","Recording Media","Repair Of Audio-Visual, Photographic And Information Processing Equipment",null,"Musical Instruments And Major Durables For Indoor Recreation",null,"Games, Toys And Hobbies","Equipment For Sport, Camping And Open-Air Recreation","Gardens, Plants And Flowers","Pets And Related Products","Veterinary And Other Services For Pets",null,"Recreational And Sporting Services","Cultural Services","Games Of Chance",null,"Books","Newspapers And Periodicals","Miscellaneous Printed Matter","Stationery And Drawing Materials",null,null,"Pre-Primary Education (Level 0)","Primary Education (Level 1)",null,"General Secondary Education","Vocational Or Technical Secondary Education",null,"First Stage Of Tertiary Education","Second Stage Of Tertiary Education",null,"Private Education Not Definable By Level",null,null,"Restaurants, Cafes And The Like",null,"Hairdressing Salons And Personal Grooming Establishments","Other Appliances, Articles And Products For Personal Care",null,"Jewellery, Clocks And Watches","Other Personal Effects"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>code<\/th>\n      <th>code_1<\/th>\n      <th>code_2<\/th>\n      <th>code_3<\/th>\n      <th>item_category_1<\/th>\n      <th>item_category_2<\/th>\n      <th>item_category_3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.3: A Spread Out <code>description</code> per Item Category Level.
</p>
</div>
<p>The two important arguments to <code>tidyr::spread()</code>, aside from the data, is the column to spread out and the column of values that will be used to fill the new columns. Unfortunately, this will result with missing categories at each level.</p>
</div>
<div id="pull-the-one-above" class="section level2">
<h2><span class="header-section-number">3.4</span> Pull the One Above</h2>
<p>The encoding of the <code>code</code> column becomes a blessing once again when we use <code>dplyr::arrange()</code> <span class="citation">(Wickham et al. 2018)</span>. Figure <a href="#fig:spread-description">3.3</a> shows that when it is arranged by <code>code</code>, the main categories are above the subcategories, and the subcategories are above the sub-subcategories. Also, the missing categories are underneath the categories they should belong too. This allows us to use <code>tidyr::fill()</code> to supply the missing categories.</p>
<p><code>tidyr::fill()</code> takes the value above the row as a replacement if the row is empty or <code>NA</code>. I had to be careful though. I did not want the subcategories and sub-subcategories leaking to the main categories. I avoided this by sequentially using <code>dplyr::group_by()</code> and <code>tidyr::fill()</code>. I grouped by <code>code_1</code> first, filled the main categories, then grouped by <code>item_category_1</code>, filled the subcategories. Nothing should be done with the sub-subcategories.</p>
<div class="figure"><span id="fig:fill-category-level"></span>
<div id="htmlwidget-6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2","07.2.3","07.3","07.3.1","07.3.2","07.3.3","07.3.4","08","08.1","08.1.0","08.2","08.2.0","08.3","08.3.0","09","09.1","09.1.1","09.1.2","09.1.3","09.1.4","09.1.5","09.2","09.2.2","09.3","09.3.1","09.3.2","09.3.3","09.3.4","09.3.5","09.4","09.4.1","09.4.2","09.4.3","09.5","09.5.1","09.5.2","09.5.3","09.5.4","10","10.1","10.1.1","10.1.2","10.2","10.2.1","10.2.3","10.4","10.4.1","10.4.2","10.5","10.5.2","11","11.1","11.1.1","11.2","11.2.1","11.2.3","11.3","11.3.1","11.3.2"],["All Items","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Health","Health","Health","Health","Health","Health","Health","Health","Health","Health","Health","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Transport","Communication","Communication","Communication","Communication","Communication","Communication","Communication","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Recreation And Culture","Education","Education","Education","Education","Education","Education","Education","Education","Education","Education","Education","Education","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services","Restaurants And Miscellaneous Goods And Services"],[null,null,"Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Non-Alcoholic Beverages","Non-Alcoholic Beverages","Non-Alcoholic Beverages",null,"Alcoholic Beverages","Alcoholic Beverages","Alcoholic Beverages","Alcoholic Beverages","Tobacco","Tobacco","Non-Food",null,"Clothing","Clothing","Clothing","Clothing","Clothing","Footwear","Footwear","Footwear",null,"Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Maintenance And Repair Of The Dwelling","Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply And Miscellaneous Services Relating To The Dweling","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels",null,"Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings, Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Household Appliances","Household Appliances","Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Tools And Equipment For House And Garden","Tools And Equipment For House And Garden","Goods And Services For Routine Household Maintenance","Goods And Services For Routine Household Maintenance","Goods And Services For Routine Household Maintenance",null,"Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Out-Patient Services","Out-Patient Services","Out-Patient Services","Out-Patient Services","Hospital Services","Hospital Services",null,"Operation Of Personal Transport Equipment","Operation Of Personal Transport Equipment","Operation Of Personal Transport Equipment","Operation Of Personal Transport Equipment","Transport Services","Transport Services","Transport Services","Transport Services","Transport Services",null,"Postal Services","Postal Services","Telephone And Telefax Equipment","Telephone And Telefax Equipment","Telephone And Telefax Services","Telephone And Telefax Services",null,"Audio-Visual, Photographic And Information Processing Equipment","Audio-Visual, Photographic And Information Processing Equipment","Audio-Visual, Photographic And Information Processing Equipment","Audio-Visual, Photographic And Information Processing Equipment","Audio-Visual, Photographic And Information Processing Equipment","Audio-Visual, Photographic And Information Processing Equipment","Other Major Durables For Recreation And Culture","Other Major Durables For Recreation And Culture","Other Recreational Items And Equipment, Gardens And Pets","Other Recreational Items And Equipment, Gardens And Pets","Other Recreational Items And Equipment, Gardens And Pets","Other Recreational Items And Equipment, Gardens And Pets","Other Recreational Items And Equipment, Gardens And Pets","Other Recreational Items And Equipment, Gardens And Pets","Recreational And Cultural Services","Recreational And Cultural Services","Recreational And Cultural Services","Recreational And Cultural Services","Newspapers, Books And Stationery","Newspapers, Books And Stationery","Newspapers, Books And Stationery","Newspapers, Books And Stationery","Newspapers, Books And Stationery",null,"Pre-Primary And Primary Education","Pre-Primary And Primary Education","Pre-Primary And Primary Education","Secondary Education","Secondary Education","Secondary Education","Tertiary Education","Tertiary Education","Tertiary Education","Education Not Definable By Level","Education Not Definable By Level",null,"Catering Services","Catering Services","Personal Care","Personal Care","Personal Care","Personal Effects N.E.C.","Personal Effects N.E.C.","Personal Effects N.E.C."],[null,null,null,"Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.",null,"Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices",null,null,"Spirits","Wine","Beer",null,"Tobacco",null,null,null,"Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing",null,"Shoes And Other Footwear","Repair And Hire Of Footwear",null,null,"Rentals For Housing",null,"Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling",null,"Water Supply",null,"Electricity","Gas","Solid Fuels",null,null,"Furniture And Furnishings","Carpets And Other Floor Coverings",null,"Household Textiles",null,"Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances",null,"Glassware, Tableware And Household Utensils",null,"Major Tools And Equipment","Small Tools And Miscellaneous Accessories",null,"Non-Durable Household Goods","Domestic Services And Household Services",null,null,"Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment",null,"Medical Services","Dental Services","Paramedical Services",null,"Hospital Services",null,null,"Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment","Maintenance And Repair Of Personal Transport Equipment",null,"Passenger Transport By Railway","Passenger Transport By Road","Passenger Transport By Air","Passenger Transport By Sea And Inland Waterway",null,null,"Postal Services",null,"Telephone And Telefax Equipment",null,"Telephone And Telefax Services",null,null,"Equipment For The Reception, Recording And Reproduction Of Sound And Pictures","Photographic And Cinematographic Equipment And Optical Instruments","Information Processing Equipment","Recording Media","Repair Of Audio-Visual, Photographic And Information Processing Equipment",null,"Musical Instruments And Major Durables For Indoor Recreation",null,"Games, Toys And Hobbies","Equipment For Sport, Camping And Open-Air Recreation","Gardens, Plants And Flowers","Pets And Related Products","Veterinary And Other Services For Pets",null,"Recreational And Sporting Services","Cultural Services","Games Of Chance",null,"Books","Newspapers And Periodicals","Miscellaneous Printed Matter","Stationery And Drawing Materials",null,null,"Pre-Primary Education (Level 0)","Primary Education (Level 1)",null,"General Secondary Education","Vocational Or Technical Secondary Education",null,"First Stage Of Tertiary Education","Second Stage Of Tertiary Education",null,"Private Education Not Definable By Level",null,null,"Restaurants, Cafes And The Like",null,"Hairdressing Salons And Personal Grooming Establishments","Other Appliances, Articles And Products For Personal Care",null,"Jewellery, Clocks And Watches","Other Personal Effects"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>code<\/th>\n      <th>item_category_1<\/th>\n      <th>item_category_2<\/th>\n      <th>item_category_3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.4: No More Missing Categories.
</p>
</div>
<p>As the reader can see in Figure <a href="#fig:fill-category-level">3.4</a>, I also removed the helper columns and kept only what is necessary.</p>
</div>
</div>
<div id="join-and-split" class="section level1">
<h1><span class="header-section-number">4</span> Join and Split</h1>
<p>The third tidy data principal is every observational unit should form a table. I think observations of item categories are better separated into different data sets. Combining them will be easier later, but working with this amount of data with different observational unit is not conducive for easy analysis, in my opinion.</p>
<p>I joined the table we just completed above with the original<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> consumer price index data using <code>dplyr::inner_join()</code> with the <code>code</code> column as the joining column. Each row will then have columns that will identify its category group.</p>
<div class="figure"><span id="fig:join-cpi-description"></span>
<div id="htmlwidget-7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7">{"x":{"filter":"none","extensions":["FixedColumns"],"data":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],["Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines","Philippines"],["0","01","01.1","01.1.1","01.1.11","01.1.12","01.1.120","01.1.2","01.1.3","01.1.4","01.1.5","01.1.6","01.1.7","01.1.8","01.1.9","01.2","01.2.1","01.2.2","02","02.1","02.1.1","02.1.2","02.1.3","02.2","02.2.0","02.40","03","03.1","03.1.1","03.1.2","03.1.3","03.1.4","03.2","03.2.1","03.2.2","04","04.1","04.1.1","04.3","04.3.1","04.3.2","04.4","04.4.1","04.5","04.5.1","04.5.2","04.5.4","05","05.1","05.1.1","05.1.2","05.2","05.2.0","05.3","05.3.1","05.3.2","05.3.3","05.4","05.4.0","05.5","05.5.1","05.5.2","05.6","05.6.1","05.6.2","06","06.1","06.1.1","06.1.2","06.1.3","06.2","06.2.1","06.2.2","06.2.3","06.3","06.3.0","07","07.2","07.2.1","07.2.2"],["All Items","Food And Non-Alcoholic Beverages","Food","Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.","Non-Alcoholic Beverages","Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices","Alcoholic Beverages And Tobacco","Alcoholic Beverages","Spirits","Wine","Beer","Tobacco","Tobacco","Non-Food","Clothing And Footwear","Clothing","Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing","Footwear","Shoes And Other Footwear","Repair And Hire Of Footwear","Housing, Water, Electricity, Gas And Other Fuels","Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply","Electricity, Gas And Other Fuels","Electricity","Gas","Solid Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings","Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Major Tools And Equipment","Small Tools And Miscellaneous Accessories","Goods And Services For Routine Household Maintenance","Non-Durable Household Goods","Domestic Services And Household Services","Health","Medical Products, Appliances And Equipment","Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment","Out-Patient Services","Medical Services","Dental Services","Paramedical Services","Hospital Services","Hospital Services","Transport","Operation Of Personal Transport Equipment","Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment"],["49.4","54.4","54.0","55.3","56.9","49.0","51.9","58.4","49.2","52.7","45.3","53.3","52.2","44.1","61.0","59.8","56.3","62.6","54.3","50.6","53.7","51.5","48.1","58.2","58.2","46.1","58.0","58.7","77.0","61.3","57.5","46.6","56.1","56.1","-","43.6","41.5","41.5","57.2","60.5","44.6","43.6","43.6","46.6","50.2","27.5","57.6","56.7","54.3","54.3","-","72.6","72.6","73.1","76.9","70.9","-","62.5","62.5","69.8","-","69.8","50.2","60.5","36.0","41.6","45.4","44.2","61.7","-","33.8","33.7","35.4","-","42.4","42.4","35.1","33.8","62.0","26.4"],["1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31","1994-01-31"],["All Items","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Food And Non-Alcoholic Beverages","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Alcoholic Beverages And Tobacco","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Clothing And Footwear","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Housing, Water, Electricity, Gas And Other Fuels","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Furnishings, Household Equipment And Routing Maintenance Of The House","Health","Health","Health","Health","Health","Health","Health","Health","Health","Health","Health","Transport","Transport","Transport","Transport"],[null,null,"Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Food","Non-Alcoholic Beverages","Non-Alcoholic Beverages","Non-Alcoholic Beverages",null,"Alcoholic Beverages","Alcoholic Beverages","Alcoholic Beverages","Alcoholic Beverages","Tobacco","Tobacco","Non-Food",null,"Clothing","Clothing","Clothing","Clothing","Clothing","Footwear","Footwear","Footwear",null,"Rentals For Housing","Rentals For Housing","Maintenance And Repair Of The Dwelling","Maintenance And Repair Of The Dwelling","Maintenance And Repair Of The Dwelling","Water Supply And Miscellaneous Services Relating To The Dweling","Water Supply And Miscellaneous Services Relating To The Dweling","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels","Electricity, Gas And Other Fuels",null,"Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings, Carpets And Other Floor Coverings","Furniture And Furnishings, Carpets And Other Floor Coverings","Household Textiles","Household Textiles","Household Appliances","Household Appliances","Household Appliances","Household Appliances","Glassware, Tableware And Household Utensils","Glassware, Tableware And Household Utensils","Tools And Equipment For House And Garden","Tools And Equipment For House And Garden","Tools And Equipment For House And Garden","Goods And Services For Routine Household Maintenance","Goods And Services For Routine Household Maintenance","Goods And Services For Routine Household Maintenance",null,"Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Medical Products, Appliances And Equipment","Out-Patient Services","Out-Patient Services","Out-Patient Services","Out-Patient Services","Hospital Services","Hospital Services",null,"Operation Of Personal Transport Equipment","Operation Of Personal Transport Equipment","Operation Of Personal Transport Equipment"],[null,null,null,"Bread And Cereals","Rice","Corn","Other Cereals, Flour, Cereal Preparation, Bread,  Pasta And Other Bakery Products","Meat","Fish","Milk, Cheese And Eggs","Oils And Fats","Fruit","Vegetables","Sugar, Jam, Honey, Chocolate And Confectionery","Food Products N.E.C.",null,"Coffee, Tea And Cocoa","Mineral Water, Soft Drinks, Fruit And Vegetable Juices",null,null,"Spirits","Wine","Beer",null,"Tobacco",null,null,null,"Clothing Materials","Garments","Other Articles Of Clothing And Clothing Accessories","Cleaning, Repair And Hire Of Clothing",null,"Shoes And Other Footwear","Repair And Hire Of Footwear",null,null,"Rentals For Housing",null,"Materials For The Maintenance And Repair Of The Dwelling","Services For The Maintenance And Repair Of The Dwelling",null,"Water Supply",null,"Electricity","Gas","Solid Fuels",null,null,"Furniture And Furnishings","Carpets And Other Floor Coverings",null,"Household Textiles",null,"Major Household Appliances Whether Electric Or Not","Small Electric Household Appliances","Repair Of Household Appliances",null,"Glassware, Tableware And Household Utensils",null,"Major Tools And Equipment","Small Tools And Miscellaneous Accessories",null,"Non-Durable Household Goods","Domestic Services And Household Services",null,null,"Pharmaceutical Products","Other Medical Products","Therapeutic Appliances And Equipment",null,"Medical Services","Dental Services","Paramedical Services",null,"Hospital Services",null,null,"Spare Parts And Accessories For Personal Transport Equipment","Fuels And Lubricants For Personal Transport Equipment"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>geographic_code<\/th>\n      <th>geographic_code_1<\/th>\n      <th>geographic_location<\/th>\n      <th>code<\/th>\n      <th>description<\/th>\n      <th>cpi<\/th>\n      <th>date_cpi<\/th>\n      <th>item_category_1<\/th>\n      <th>item_category_2<\/th>\n      <th>item_category_3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":[0,1,2,3,4,5,6,7,8,9]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 4.1: The Philippine Consumer Price Index Data Categorized by Item.
</p>
</div>
<p>I split the table by categories by counting the dots again. If the <code>code</code> column has zero dots, then it should be in the primary categories table, one dot to secondary categories, and three dots to tertiary categories.</p>
<p>Observed that I created a function and use <code>purrr::map()</code> <span class="citation">(Henry and Wickham 2018)</span> to save the three data sets. I think I will use this next time too. <code>purrr::map()</code> returns a list, but since I ma just saving and expecting no output, I get these <code>NULL</code> results. I wonder if there is a function to avoid this. I tried <code>lapply</code>, but I got the same result. Anyway, what is important is that the new data sets are now saved.</p>
</div>
<div id="up-next" class="section level1">
<h1><span class="header-section-number">5</span> Up Next</h1>
<p>Looking at Figure <a href="#fig:join-cpi-description">4.1</a>, we see three columns that refers to location. We will work on this next time.</p>
</div>
<div id="code" class="section level1">
<h1><span class="header-section-number">6</span> Code</h1>
<p>The following codes show what I did in this post. The logic of each code should have been captured in the discussion, but I added comments here and there to further clarify my thought process.</p>
<pre class="r"><code># Attach packages and set chunk options

xfun::pkg_attach(
  &quot;knitr&quot;,
  &quot;tidyverse&quot;,
  &quot;magrittr&quot;,
  &quot;DT&quot;,
  &quot;rebus&quot;,
  &quot;janitor&quot;
)

opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = FALSE
)


# read the partially-cleaned data and clean the column names

iso_8601_cpi_data &lt;- 
  readr::read_rds(&quot;./data/ph-cpi-data/partial-tidy/iso-8601-cpi-data.RDS&quot;) %&gt;% 
  janitor::clean_names()

# create standard datatable function to be used in all tables in this post

show_datatable &lt;- function(cpi_data) {
  cpi_data %&gt;% 
    DT::datatable(
      rownames = FALSE,
      extensions = &#39;FixedColumns&#39;,
      options = list(
        pageLength = 20,
        scrollX = TRUE,
        scrollCollapse = TRUE,
        columnDefs = list(
          list(
            className = &#39;dt-center&#39;,
            targets = 0:(ncol(cpi_data) - 1)
          )
        )
      )
    )
}

# show sample data

iso_8601_cpi_data %&gt;% 
  head(40) %&gt;% 
  show_datatable()


# isoalte code and description column

item_code_description &lt;- 
  iso_8601_cpi_data %&gt;% 
  distinct(code, description)

# display isolated code and description column

item_code_description %&gt;% 
  show_datatable()


# remove the Non-Alcholic row

item_code_description &lt;- 
  item_code_description %&gt;% 
  filter(
    !stringr::str_detect(
      description,
      &quot;Non-Alcholic&quot;
    )
  )



# separate code into category level pieces

separate_item_code &lt;- 
  item_code_description %&gt;% 
  # split the code column into individual categories; this ensures that any
  # extra category added in the future will cause an error
  tidyr::separate(
    code,
    into = c(
      &quot;code_1&quot;,
      &quot;code_2&quot;,
      &quot;code_3&quot;
    ),
    # keep the code column
    remove = FALSE
  )

# show the result of separate

separate_item_code %&gt;% 
  show_datatable()


# identify the category level of the description

description_level &lt;- 
  separate_item_code %&gt;% 
  mutate(
    # count the dots; add one to classify the correct level
    category_level = str_count(
      code, DOT
    ) + 1,
    # add item category to assist in converting to columns later
    category_level = str_c(
      &quot;item_category&quot;,
      category_level,
      sep = &quot;_&quot;
    )
  )

# show the result of the spread 

description_level %&gt;% 
  show_datatable()


# spread description column using category levels as variables/column heads

spread_description &lt;- 
  description_level %&gt;% 
  spread(
    category_level,
    description
  )

# show result of spread

spread_description %&gt;% 
  show_datatable()


# fill the missing categories; arrange first by code then sequentially use
# group_by and fill

complete_item_description_code &lt;- 
  spread_description %&gt;% 
  # ensure tibble is arranged by code column
  arrange(code) %&gt;% 
  # fill main categories first
  group_by(code_1) %&gt;% 
  fill(item_category_1) %&gt;%
  # fill subcategories, making sure subcategories do not leak out to main
  # categories by grouping by mainc ategory first
  group_by(item_category_1) %&gt;% 
  fill(item_category_2) %&gt;% 
  # remove the unnecessary columns
  select(-matches(START %R% &quot;code_&quot; %R% DGT %R% END)) %&gt;% 
  # fix default arrangement that was ruined by grouping
  ungroup() %&gt;% 
  arrange(code)

# show final item description code and level guide

complete_item_description_code %&gt;% 
  show_datatable()
  


# join item categories to original data

categorized_cpi_data &lt;- 
  iso_8601_cpi_data %&gt;% 
  inner_join(
    complete_item_description_code,
    by = &quot;code&quot;
  )

# show sample of categorized data

categorized_cpi_data %&gt;% 
  head(80) %&gt;% 
  show_datatable()


# separate the table by category levels

primary_item_cpi &lt;- 
  categorized_cpi_data %&gt;% 
  filter(
    str_count(
      code,
      DOT
    ) == 0
  ) %&gt;% 
  select(-item_category_2, -item_category_3)

secondary_item_cpi &lt;- 
  categorized_cpi_data %&gt;% 
  filter(
    str_count(
      code,
      DOT
    ) == 1
  ) %&gt;% 
  select(-item_category_3)

tertiary_item_cpi &lt;- 
  categorized_cpi_data %&gt;% 
  filter(
    str_count(
      code,
      DOT
    ) == 2
  )

# create saving function

save_categorized_tibble &lt;- function(object_name) {
  saveRDS(
    get(object_name), 
    sprintf(
      &quot;./data/ph-cpi-data/partial-tidy/categorized-cpi/%s&quot;,
      str_replace_all(object_name, &quot;_&quot;, &quot;-&quot;)
    )
  )
}

# save the new data sets

map(
  paste0(
    c(&quot;primary&quot;, &quot;secondary&quot;, &quot;tertiary&quot;),
    &quot;_item_cpi&quot;
  ),
  save_categorized_tibble
)




sessionInfo()</code></pre>
<p>My session info for reproducibility.</p>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17134)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_Philippines.1252 
## [2] LC_CTYPE=English_Philippines.1252   
## [3] LC_MONETARY=English_Philippines.1252
## [4] LC_NUMERIC=C                        
## [5] LC_TIME=English_Philippines.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bindrcpp_0.2.2  janitor_1.1.1   rebus_0.1-3     DT_0.4         
##  [5] magrittr_1.5    forcats_0.3.0   stringr_1.3.1   dplyr_0.7.6    
##  [9] purrr_0.2.5     readr_1.1.1     tidyr_0.8.1     tibble_1.4.2   
## [13] ggplot2_3.0.0   tidyverse_1.2.1 knitr_1.20     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.19          lubridate_1.7.4       lattice_0.20-35      
##  [4] assertthat_0.2.0      rprojroot_1.3-2       digest_0.6.18        
##  [7] mime_0.6              R6_2.3.0              cellranger_1.1.0     
## [10] plyr_1.8.4            backports_1.1.2       evaluate_0.12        
## [13] httr_1.3.1            blogdown_0.8          pillar_1.3.0         
## [16] rlang_0.2.2           lazyeval_0.2.1        readxl_1.1.0         
## [19] rstudioapi_0.8        rebus.base_0.0-3      rmarkdown_1.10       
## [22] htmlwidgets_1.3       munsell_0.5.0         shiny_1.1.0          
## [25] broom_0.5.0           compiler_3.5.1        httpuv_1.4.5         
## [28] modelr_0.1.2          xfun_0.3              pkgconfig_2.0.2      
## [31] htmltools_0.3.6       tidyselect_0.2.5      bookdown_0.7         
## [34] rebus.numbers_0.0-1   crayon_1.3.4          withr_2.1.2          
## [37] later_0.7.5           grid_3.5.1            nlme_3.1-137         
## [40] jsonlite_1.5          xtable_1.8-3          gtable_0.2.0         
## [43] scales_1.0.0          cli_1.0.1             stringi_1.2.4        
## [46] promises_1.0.1        snakecase_0.9.2       xml2_1.2.0           
## [49] tools_3.5.1           glue_1.3.0            rebus.unicode_0.0-2  
## [52] hms_0.4.2             crosstalk_1.0.0       rebus.datetimes_0.0-1
## [55] yaml_2.2.0            colorspace_1.3-2      rvest_0.3.2          
## [58] bindr_0.1.1           haven_1.1.2</code></pre>
</div>
<div id="references" class="section level1">
<h1><span class="header-section-number">7</span> References</h1>
<p>For more information on tidy principles, techniques, and good practices, and the packages and functions I used in this post, please read</p>
<div id="refs" class="references">
<div id="ref-R-rebus">
<p>Cotton, Richard. 2017. <em>Rebus: Build Regular Expressions in a Human Readable Way</em>. <a href="https://CRAN.R-project.org/package=rebus" class="uri">https://CRAN.R-project.org/package=rebus</a>.</p>
</div>
<div id="ref-R-janitor">
<p>Firke, Sam. 2018. <em>Janitor: Simple Tools for Examining and Cleaning Dirty Data</em>. <a href="https://CRAN.R-project.org/package=janitor" class="uri">https://CRAN.R-project.org/package=janitor</a>.</p>
</div>
<div id="ref-R-purrr">
<p>Henry, Lionel, and Hadley Wickham. 2018. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr" class="uri">https://CRAN.R-project.org/package=purrr</a>.</p>
</div>
<div id="ref-tidy-data">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>The Journal of Statistical Software</em> 59 (10). <a href="http://www.jstatsoft.org/v59/i10/" class="uri">http://www.jstatsoft.org/v59/i10/</a>.</p>
</div>
<div id="ref-R-stringr">
<p>———. 2018. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a>.</p>
</div>
<div id="ref-R-tidyr">
<p>Wickham, Hadley, and Lionel Henry. 2018. <em>Tidyr: Easily Tidy Data with ’Spread()’ and ’Gather()’ Functions</em>. <a href="https://CRAN.R-project.org/package=tidyr" class="uri">https://CRAN.R-project.org/package=tidyr</a>.</p>
</div>
<div id="ref-R-dplyr">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2018. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
<div id="ref-R-DT">
<p>Xie, Yihui. 2018. <em>DT: A Wrapper of the Javascript Library ’Datatables’</em>. <a href="https://CRAN.R-project.org/package=DT" class="uri">https://CRAN.R-project.org/package=DT</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>For reference, the data I am tidying here is the Philippines consumer price index from 1994 Jan to 2018 Jun retrieved <a href="http://openstat.psa.gov.ph/dataset/prices-and-related-indices">here</a> on 2018 Sep 28<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>I know that this hard coding of three columns is not good in case future data sets have a <code>code</code> column that has four category levels. However, <code>tidyr::separate()</code> will throw an error in case there are more than three categories in the future. Also, my hope is that this new format will be favored than the current one.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>The one with single column of dates in ISO 8601 format.<a href="#fnref3">↩</a></p></li>
</ol>
</div>
