---
title: One Function Call to Manipulate and Plot Them All
author: Recle Etino Vibal
date: '2019-01-14'
categories:
  - data manipulation
  - data visualisation
  - functional programming
  - lessons
tags:
  - baseR
  - bquote
  - data.table
  - function
  - ggplot2
  - quasiquotation
slug: function-manipulate-plot
description: Functional Programming in {data.table} and {ggplot2} with bquote()
output:
  blogdown::html_page:
    toc: yes
    number_sections: yes
bibliography:
  - references/function-manipulate-plot.bib
biblio-style: apalike
---


<div id="TOC">
<ul>
<li><a href="#motivation-to-automation"><span class="toc-section-number">1</span> Motivation to Automation</a></li>
<li><a href="#dplyr-and-rlang-solution"><span class="toc-section-number">2</span> <code>dplyr</code> and <code>rlang</code> Solution</a></li>
<li><a href="#session-info"><span class="toc-section-number">3</span> Session Info</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<pre class="r"><code>xfun::pkg_attach(
  &quot;knitr&quot;,
  &quot;data.table&quot;,
  &quot;ggplot2&quot;,
  &quot;rlang&quot;,
  &quot;dplyr&quot;
)

opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  echo = TRUE
)

# Create a data.table version of the mtcars data set. I explicitly specified to exclude rownames just to be clear (The default in data.table is FALSE).
dt_mtcars &lt;- data.table(mtcars, keep.rownames = FALSE)

# Convert some columns from numeric to factor. I am not sure if this is the most
# efficient way to update multiple columns in data.table, but it works for my
# purposes.
dt_mtcars[
  ,
  c(&quot;cyl&quot;, &quot;vs&quot;, &quot;am&quot;, &quot;gear&quot;) := 
    lapply(.SD, factor),
  .SDcols = c(&quot;cyl&quot;, &quot;vs&quot;, &quot;am&quot;, &quot;gear&quot;)
]</code></pre>
<div id="motivation-to-automation" class="section level1">
<h1><span class="header-section-number">1</span> Motivation to Automation</h1>
<p>In my new role as a <a href="https://amateurdatasci.rbind.io/post/loves-what-he-is-doing/">junior data scientist</a>, I have to analyse and manipulate on a regular<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> basis using <code>R</code>. One common task I always do during exploratory data analysis until production is to check the effect or relationship of one or more exploratory variables to another in terms of a certain metric or summary of a response variable.</p>
<p>For example,</p>
<pre class="r"><code>dt_mtcars[
  ,
  .(disp_avg = mean(disp)),
  .(cyl, vs, am, gear)
] %&gt;% 
  ggplot(
    aes(gear, disp_avg, fill = cyl)
  ) +
  geom_col(position = &quot;dodge&quot;) +
  facet_wrap(
    vars(vs, am),
    ncol = 2
  )</code></pre>
<p><img src="/post/2019-01-14-function-manipulate-plot_files/figure-html/sample-factors-metric-plot-1.png" width="672" /></p>
<p>This is an easy enough plot to do, but what if I wanted to look at a different metric instead of the average, or a different response variable? What if I wanted to have a different set of explanatory variables, or I want different variables on the x-axis, fill, and facets? It gets too repetitive. When repition becomes apparent and burdensome, <strong>automate</strong>.</p>
</div>
<div id="dplyr-and-rlang-solution" class="section level1">
<h1><span class="header-section-number">2</span> <code>dplyr</code> and <code>rlang</code> Solution</h1>
<p>In one of my works, I already made code to capture the workflow of this data summary and plotting but using <code>rlang</code> <span class="citation">(Henry and Wickham 2018)</span>.</p>
</div>
<div id="session-info" class="section level1">
<h1><span class="header-section-number">3</span> Session Info</h1>
<pre class="r"><code>sessioninfo::session_info()</code></pre>
<pre><code>## - Session info ----------------------------------------------------------
##  setting  value                       
##  version  R version 3.5.2 (2018-12-20)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  English_Philippines.1252    
##  ctype    English_Philippines.1252    
##  tz       Asia/Kuala_Lumpur           
##  date     2019-01-08                  
## 
## - Packages --------------------------------------------------------------
##  package     * version date       lib source                         
##  assertthat    0.2.0   2017-04-11 [1] CRAN (R 3.5.0)                 
##  bindr         0.1.1   2018-03-13 [1] CRAN (R 3.5.0)                 
##  bindrcpp      0.2.2   2018-03-29 [1] CRAN (R 3.5.0)                 
##  blogdown      0.9     2018-10-23 [1] CRAN (R 3.5.1)                 
##  bookdown      0.9     2018-12-21 [1] CRAN (R 3.5.2)                 
##  cli           1.0.1   2018-09-25 [1] CRAN (R 3.5.1)                 
##  colorspace    1.3-2   2016-12-14 [1] CRAN (R 3.5.0)                 
##  crayon        1.3.4   2017-09-16 [1] CRAN (R 3.5.0)                 
##  data.table  * 1.11.8  2018-09-30 [1] CRAN (R 3.5.1)                 
##  digest        0.6.18  2018-10-10 [1] CRAN (R 3.5.1)                 
##  dplyr       * 0.7.8   2018-11-10 [1] CRAN (R 3.5.1)                 
##  evaluate      0.12    2018-10-09 [1] CRAN (R 3.5.1)                 
##  ggplot2     * 3.1.0   2018-10-25 [1] CRAN (R 3.5.1)                 
##  glue          1.3.0   2018-10-03 [1] Github (tidyverse/glue@4e74901)
##  gtable        0.2.0   2016-02-26 [1] CRAN (R 3.5.0)                 
##  htmltools     0.3.6   2017-04-28 [1] CRAN (R 3.5.0)                 
##  knitr       * 1.21    2018-12-10 [1] CRAN (R 3.5.1)                 
##  labeling      0.3     2014-08-23 [1] CRAN (R 3.5.0)                 
##  lazyeval      0.2.1   2017-10-29 [1] CRAN (R 3.5.0)                 
##  magrittr      1.5     2014-11-22 [1] CRAN (R 3.5.0)                 
##  munsell       0.5.0   2018-06-12 [1] CRAN (R 3.5.0)                 
##  pillar        1.3.1   2018-12-15 [1] CRAN (R 3.5.1)                 
##  pkgconfig     2.0.2   2018-08-16 [1] CRAN (R 3.5.1)                 
##  plyr          1.8.4   2016-06-08 [1] CRAN (R 3.5.0)                 
##  purrr         0.2.5   2018-05-29 [1] CRAN (R 3.5.0)                 
##  R6            2.3.0   2018-10-04 [1] CRAN (R 3.5.1)                 
##  Rcpp          1.0.0   2018-11-07 [1] CRAN (R 3.5.1)                 
##  rlang       * 0.3.0.1 2018-10-25 [1] CRAN (R 3.5.1)                 
##  rmarkdown     1.11    2018-12-08 [1] CRAN (R 3.5.1)                 
##  scales        1.0.0   2018-08-09 [1] CRAN (R 3.5.1)                 
##  sessioninfo   1.1.1   2018-11-05 [1] CRAN (R 3.5.1)                 
##  stringi       1.2.4   2018-07-20 [1] CRAN (R 3.5.1)                 
##  stringr       1.3.1   2018-05-10 [1] CRAN (R 3.5.0)                 
##  tibble        2.0.0   2019-01-04 [1] CRAN (R 3.5.2)                 
##  tidyselect    0.2.5   2018-10-11 [1] CRAN (R 3.5.1)                 
##  withr         2.1.2   2018-03-15 [1] CRAN (R 3.5.0)                 
##  xfun          0.4     2018-10-23 [1] CRAN (R 3.5.1)                 
##  yaml          2.2.0   2018-07-25 [1] CRAN (R 3.5.1)                 
## 
## [1] C:/Users/recleev/R/R-3.5.2/library</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-R-rlang">
<p>Henry, Lionel, and Hadley Wickham. 2018. <em>Rlang: Functions for Base Types and Core R and ’Tidyverse’ Features</em>. <a href="https://CRAN.R-project.org/package=rlang" class="uri">https://CRAN.R-project.org/package=rlang</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>At least 8 hours a day, five days a week<a href="#fnref1">↩</a></p></li>
</ol>
</div>
